{
   "steps": [{
      "name": "gcr.io/cloud-builders/docker",
      "args": [
         "build",
         "-t",
         "gcr.io/$PROJECT_ID/telegrambot-image:$COMMIT_SHA",
         "."
      ]
   },
   {
      "name": "gcr.io/cloud-builders/docker",
      "args": [
         "run",
         "gcr.io/$PROJECT_ID/telegrambot-image:$COMMIT_SHA",
         "black",
         "--check",
         "."
      ]
   },
   {
      "name": "gcr.io/cloud-builders/docker",
      "args": [
         "build",
         "-t",
         "telegrambot_ci_image",
         "-f",
         "Dockerfile.ci",
         "--build-arg=APP_IMAGE=gcr.io/$PROJECT_ID/telegrambot-image:$COMMIT_SHA",
         "."
      ]
   },
   {
      "name": "gcr.io/cloud-builders/docker",
      "args": ["run", "telegrambot_ci_image"]
   },
   {
      "name": "gcr.io/cloud-builders/docker",
      "args": ["push", "gcr.io/$PROJECT_ID/telegrambot-image"]
   },
   {
      "name": "gcr.io/cloud-builders/gcloud",
      "args": [
         "run",
         "deploy",
         "telegrambot",
         "--image",
         "gcr.io/$PROJECT_ID/telegrambot-image:$COMMIT_SHA",
         "--region",
         "europe-west1",
         "--platform",
         "managed"
      ]
   }],
   "images": [
      "gcr.io/$PROJECT_ID/telegrambot-image:$COMMIT_SHA"
    ]
}
